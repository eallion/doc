\> æœ¬æ–‡ç”± \[ç®€æ‚¦ SimpRead\](http://ksria.com/simpread/) è½¬ç ï¼Œ åŸæ–‡åœ°å€ \[www.dreamsafari.info\](https://www.dreamsafari.info/2020/04/hugo-loveit-mod/)

 2020.4.10 Â 2020.7.10 Â [Hello IT](https://www.dreamsafari.info/categories/hello-it/) Â 6344 Â 13Â åˆ†é’Ÿ

ç›®å½•
--

1.  [1\. ç›¸å…³æ–‡ç« ](#1-ç›¸å…³æ–‡ç« )
2.  [2\. å…¨æ–‡æœç´¢ï¼ˆAlgoliaï¼‰](#2-å…¨æ–‡æœç´¢algolia)
    1.  [2.1 ç”Ÿæˆç´¢å¼•](#21-ç”Ÿæˆç´¢å¼•)
    2.  [2.2 ä¸Šä¼ ç´¢å¼•](#22-ä¸Šä¼ ç´¢å¼•)
    3.  [2.3 ä¿®æ”¹ Algolia çš„è®¾ç½®](#23-ä¿®æ”¹algoliaçš„è®¾ç½®)
    4.  [2.4 å’Œ Netlify ç»“åˆ](#24-å’Œnetlifyç»“åˆ)
    5.  [2.5 ä¸ºä¸»é¢˜å¢åŠ æœç´¢é¡µ](#25-ä¸ºä¸»é¢˜å¢åŠ æœç´¢é¡µ)
3.  [3\. PWA](#3-pwa)
4.  [4\. Disqus ä»£ç†](#4-disqusä»£ç†)
5.  [5\. æ‡’äººæ–¹æ¡ˆ](#5-æ‡’äººæ–¹æ¡ˆ)
6.  [6\. åè¯](#6-åè¯)

åœ¨[ä¸Šä¸€ç¯‡æ–‡ç« ](https://www.dreamsafari.info/2020/03/golden-memories/)é‡Œé¢åˆšè¯´å¥½ä¸è¦_**åˆæ˜¯ä¸€ç¯‡æŠ€æœ¯åšå®¢**_ï¼Œç»“æœï¼Œå¯èƒ½æˆ‘ä»Šå¤©å°±è¦æ°´ä¸€ç¯‡äº†â€¦â€¦ ä¸»è¦åŸå› æ˜¯è§‰å¾—ç”¨äº† [LoveIT](https://github.com/dillonzq/LoveIt) è¿™ä¸ªä¸»é¢˜ä¹‹åï¼Œè§‰å¾—è¿˜æ˜¯æœ‰ç‚¹ç¾ä¸­ä¸è¶³ï¼Œæ‰€ä»¥è‡ªå·±åŠ¨æ‰‹ä¿®æ”¹äº†ä¸€ä¸‹ã€‚ä¿®æ”¹å®Œäº†è§‰å¾—ï¼Œæ€»å¾—æ‰¾ä¸ªåœ°æ–¹è®°å½•ä¸€ä¸‹ï¼Œä»¥å…ï¼Œä¹‹åè‡ªå·±å¿˜è®°æ€ä¹ˆæã€‚ä¸‹é¢è¯´çš„ä¿®æ”¹éƒ½ä»¥ [LoveIT](https://github.com/dillonzq/LoveIt) ä¸ºä¾‹ï¼Œå…¶ä»–çš„ä¸»é¢˜å¯ä»¥å‚ç…§ä¿®æ”¹ã€‚

é™¤éæ‰“ç®—æäº¤ PRï¼Œå¦åˆ™ä¸å»ºè®®åœ¨ä¸»é¢˜çš„æ–‡ä»¶å¤¹å†…ç›´æ¥è¿›è¡Œä¿®æ”¹ï¼Œä¸ç„¶ä¼šç»™æ—¥åæ›´æ–°ä¸»é¢˜å¸¦æ¥å¾ˆå¤šçš„éº»çƒ¦ã€‚æ¨èæŠŠä¸»é¢˜å†…éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶å¤åˆ¶åˆ°ç«™ç‚¹æ ¹ç›®å½•å¯¹åº”ä½ç½®å†…ï¼ˆä¾‹å¦‚ï¼š/themes/LoveIt/layouts/partials/single/footer.html -> /layouts/partials/single/footer.htmlï¼‰ä¹‹åè¿›è¡Œä¿®æ”¹ã€‚hugo åœ¨ç”Ÿæˆç«™ç‚¹çš„æ—¶å€™ï¼Œä¼šä¼˜å…ˆä½¿ç”¨æ ¹ç›®å½•ä¸‹çš„åŒåæ–‡ä»¶è¦†ç›–ä¸»é¢˜æ–‡ä»¶ã€‚

[](#1-ç›¸å…³æ–‡ç« )[1\. ç›¸å…³æ–‡ç« ](#contents:1-ç›¸å…³æ–‡ç« )
---------------------------------------

ä»¥å‰ç”¨ WordPress çš„æ—¶å€™ï¼Œå¯ä»¥æ˜¾ç¤ºç›¸å…³æ–‡ç« çš„æ¨èã€‚æˆ‘è§‰å¾—è¿™ä¸ªåŠŸèƒ½æŒºå¥½ç”¨çš„ï¼Œäºæ˜¯æƒ³ç€æˆ‘ä¹Ÿè¦å¢åŠ è¿™ä¸ªåŠŸèƒ½ã€‚å› ä¸º hugo æ˜¯å…¨é™æ€çš„ï¼Œæ‰€ä»¥è¿™ä¸ªå®ç°èµ·æ¥ä¼¼ä¹æœ‰äº›éš¾åº¦ã€‚google äº†ä¸€åœˆå‘ç°äº†è¿™ç¯‡æ–‡ç« ï¼š[How to show related posts in Hugo](https://novelist.xyz/tech/related-posts-in-hugo/)ã€‚çœ‹äº†ä¸€ä¸‹åŸç†ï¼Œä¼¼ä¹æ˜¯é€šè¿‡æ–‡ç« çš„ tag æ¥å®ç°çš„ã€‚

é‚£å°±ï¼Œç…§ç€é‚£ç¯‡æ–‡ç« é‡Œé¢çš„ä»£ç ï¼Œç¨å¾®ä¿®æ”¹ä¸€ä¸‹å§ï¼š

éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶æ˜¯ / layouts/partials/single/footer.html

åœ¨åˆé€‚çš„ä½ç½®æ’å…¥ä¸‹é¢ä»£ç ï¼š

ä¸Šé¢çš„ä»£ç é»˜è®¤ä¼šæ˜¾ç¤ºæœ€å¤š 5 ç¯‡ç›¸å…³æ–‡ç« ï¼Œå¦‚æœæŸä¸€ç¯‡æ–‡ç« ä¸éœ€è¦æ˜¾ç¤ºç›¸å…³æ–‡ç« çš„è¯ï¼Œå¯ä»¥åœ¨æ–‡ç« çš„ front matter ä¸­æ‰‹åŠ¨è¾“å…¥ "RelatedPosts: false" æ¥ç¦ç”¨ç›¸å…³æ–‡ç« çš„æ˜¾ç¤ºã€‚

PS. æˆ‘åæ¥åˆå‘ç° [hugo-theme-meme](https://github.com/reuixiy/hugo-theme-meme) è¿™ä¸ªä¸»é¢˜çš„ config.toml é‡Œé¢æœ‰ç›¸å…³æ–‡ç« çš„éƒ¨åˆ†ï¼Œå¯ä»¥é€šè¿‡æ–‡ç« çš„åˆ†ç±»ï¼Œæ ‡ç­¾å’Œå‘å¸ƒæ—¥æœŸæ¥è®¾å®šæƒé‡ï¼Œæ„Ÿè§‰æ›´åŠ å…¨é¢ä¸€äº›äº†ã€‚

[](#2-å…¨æ–‡æœç´¢algolia)[2\. å…¨æ–‡æœç´¢ï¼ˆAlgoliaï¼‰](#contents:2-å…¨æ–‡æœç´¢algolia)
--------------------------------------------------------------

æ„Ÿè§‰è¿™ä¸ªæ˜¯æœ€éš¾çš„éƒ¨åˆ†ï¼Œæˆ‘æäº†å¥½ä¹…å¥½ä¹…å•Šâ€¦â€¦ æœ€å¤§çš„éš¾ç‚¹å°±åœ¨äºï¼Œå¦‚ä½•ç”Ÿæˆå…¨æ–‡çš„ç´¢å¼•ã€‚Algolia æ€ä¹ˆæ³¨å†Œä»€ä¹ˆçš„ï¼Œç½‘ä¸Šé“ºå¤©ç›–åœ°éƒ½æœ‰ï¼Œå°±ä¸å†èµ˜è¿°äº†ã€‚ä¸‹é¢å‡è®¾å·²ç»æ³¨å†Œå¥½äº† Algoliaï¼ŒåŒæ—¶ä¹Ÿå·²ç»æœ‰äº†å¯¹åº”çš„ API Keysã€‚

åœ¨ config.toml é‡Œé¢éœ€è¦è®¾ç½®ä¸‹é¢è¿™äº›å†…å®¹ï¼š

```
<div class="related-posts">
	{{- if ( .Params.RelatedPosts | default true ) -}}
		</br>
		<b>{{- printf (T "RelatedPosts") -}}</b>
		{{ range first 5 ( where ( where .Site.Pages.ByDate.Reverse ".Params.tags" "intersect" .Params.tags ) "Permalink" "!=" .Permalink ) }}
			<li class="relatedPost">
				<a href="{{ .RelPermalink }}">{{ .Title | markdownify }}</a><br />
				{{ .Description | markdownify }}
			</li>
		{{ end }}
	{{- end -}}
</div>
```

åŒæ—¶ï¼Œåœ¨ \[outputs\] ä¸­ï¼Œhome å¢åŠ  Algoliaã€‚ä¿®æ”¹å®Œæ¯•åº”è¯¥é•¿è¿™æ ·ï¼š

### [](#21-ç”Ÿæˆç´¢å¼•)[2.1 ç”Ÿæˆç´¢å¼•](#contents:21-ç”Ÿæˆç´¢å¼•)

ç”Ÿæˆæ–‡ç« çš„ç´¢å¼•æ˜¯å®ç°æœç´¢çš„ç¬¬ä¸€æ­¥ï¼Œä¹Ÿæ˜¯æœ€éº»çƒ¦çš„ä¸€æ­¥ã€‚

éº»çƒ¦çš„ç‚¹ä¸»è¦åœ¨äºï¼ŒAlgolia å…è´¹çš„æœåŠ¡é™åˆ¶äº†[æ¯ä¸€æ¡è®°å½•çš„å¤§å°ä¸èƒ½è¶…è¿‡ 10 KB](https://www.algolia.com/doc/faq/basics/is-there-a-size-limit-for-my-index-records/)ã€‚æ‰€ä»¥ï¼Œå¯¹äºä¸€äº›æ¯”è¾ƒé•¿çš„æ–‡ç« æ¥è¯´ï¼Œå¦‚æœè¦å®ç°å…¨æ–‡ç´¢å¼•ï¼Œé‚£å°±åŠ¿å¿…ç‰µæ¶‰åˆ°å¦‚ä½•åˆ†å‰²è®°å½•è¿™ä¸ªé—®é¢˜ã€‚

Algolia å®˜æ–¹çš„å»ºè®®æ˜¯å¯ä»¥æŒ‰ç…§æ¯ä¸€æ®µæ¥åˆ†å‰²è®°å½•ï¼Œå¹¶ä¸”é’ˆå¯¹ WordPress å’Œ Laravel ç»™å‡ºäº†æ•™ç¨‹ã€‚å¯æƒœçš„æ˜¯ï¼Œè¿™äº›éƒ½æ˜¯é’ˆå¯¹ PHP çš„æ•™ç¨‹ï¼Œæ²¡æ³•ç§»æ¤åˆ° hugo ä¸Šé¢ã€‚æˆ‘äºæ˜¯ google äº†ä¸€éï¼Œå‘ç°[ä¸€ä¸ªä¿„ç½—æ–¯çš„å“¥ä»¬](https://www.kizu.ru/algolia-search/)å†™äº†ä¸ª Gulp è„šæœ¬ï¼ŒæŒ‰ç…§å‰¯æ ‡é¢˜æ¥åˆ‡å‰²è®°å½•ã€‚ç„¶è€Œâ€¦â€¦ æˆ‘å¾ˆå¤šçš„æ–‡ç« å¹¶æ²¡æœ‰å‰¯æ ‡é¢˜â€¦â€¦ ç„¶åæˆ‘åˆå‘ç°äº†[è¿™ç¯‡æ–‡ç« ](https://www.bennet.org/blog/site-search-jamstack-hugo-algolia/)ã€‚è¿™ä¸ªå“¥ä»¬ä¹Ÿè·Ÿæˆ‘æœ‰åŒæ ·çš„å›°æ‰°ï¼Œäºæ˜¯é‡‡ç”¨äº†ä¸€ä¸ªæœºæ™ºçš„æ–¹æ³•ï¼Œåˆ©ç”¨ delimit å‡½æ•°ï¼Œæ¯ 1000 ä¸ªç©ºæ ¼æˆªæ–­è®°å½•ã€‚æˆ‘å°è¯•äº†ä¸€ä¸‹ï¼Œå¯è€»åœ°å¤±è´¥äº†ã€‚å¤±è´¥åŸå› ï¼šä¸­æ–‡ä»–æ²¡æœ‰ç©ºæ ¼å•Šâ€¦â€¦

ä¸è¿‡è™½ç„¶ç…§æŠ„ä»£ç å¤±è´¥äº†ï¼Œæ€è·¯è¿˜æ˜¯å¯ä»¥å€Ÿé‰´çš„ã€‚æœºæ™ºå¦‚æˆ‘æƒ³åˆ°ï¼šğŸ’¡è‹±æ–‡ç”¨ç©ºæ ¼æ¥æˆªæ–­ï¼Œä¸»è¦æ˜¯ä¸ºäº†é˜²æ­¢ä¸€ä¸ªå•è¯ä¸­é€”è¢«åˆ‡å¼€ï¼Œé‚£ä¸­æ–‡å¹¶æ²¡æœ‰è¿™ä¸ªé—®é¢˜å•Šï¼æˆ‘çš„åšå®¢ï¼Œç»å¤§å¤šæ•°çš„å†…å®¹éƒ½æ˜¯ä¸­æ–‡çš„ï¼Œæ‰€ä»¥ï¼Œç›´æ¥æˆªå–è‹¥å¹²ä¸ªå­—ç¬¦ï¼Œåº”è¯¥å°±å¥½äº†å§ï¼è‡³äºä¸ºæ•°ä¸å¤šçš„å‡ ç¯‡è‹±æ–‡åšå®¢ï¼Œå°±ï¼ŒæŠ“å¤§æ”¾å°å§â€¦â€¦ å¦‚æœæœ‰æ›´å¥½çš„åˆ‡å‰²é•¿æ–‡ç« çš„æ–¹æ³•ï¼Œå¼ºçƒˆæ¬¢è¿å¤§å®¶ä¸€èµ·è®¨è®ºã€‚

ç®€å•çˆ¬äº†ä¸€ä¸‹ [hugo çš„æ–‡æ¡£](https://gohugo.io/functions/)ï¼Œå‘ç°äº† [substr](https://gohugo.io/functions/substr/) è¿™ä¸ªå‡½æ•°æŒºæœ‰æ½œåŠ›çš„ã€‚ä¸è¿‡ä¼¼ä¹ substr ä¸èƒ½ç”¨åœ¨ Page.PlainWords ä¸Šé¢ï¼Œæ²¡å…³ç³»ï¼Œé‚£å°±æ”¹ç”¨ Page.Plain å§ã€‚

Page.Plain å¾—åˆ°çš„ç»“æœé‡Œé¢æœ‰ä¸€äº›è½¬ä¹‰çš„å­—ç¬¦éœ€è¦ä¿®æ”¹ä¸€ä¸‹ã€‚æˆ‘å°±ç›´æ¥è´´ä¸€ä¸‹[æˆ‘çš„æ¨¡æ¿](https://github.com/dreamsafari/LoveIt/blob/master/layouts/_default/list.algolia.json)å§ï¼š

```
\[outputFormats.Algolia\]
  baseName = "algolia"
  isPlainText = true
  mediaType = "application/json"
  notAlternative = true

\[params.algolia\]
  appId = ä½ çš„APP ID
  indexName = ä½ çš„indexåç§°
  searchOnlyKey = è®°å¾—è¿™é‡Œåªéœ€è¦Search-Only API Keyï¼Œä¸éœ€è¦Admin API Keyã€‚
```

æŠŠæ¨¡æ¿ä¿å­˜ä¸º / layouts/{?\_}defaults/list.algolia.jsonã€‚è¿è¡Œ hugo å‘½ä»¤ä¹‹åå°±ä¼šåœ¨ / public æ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆ algolia.jsonï¼Œå¯ä»¥ä¸Šä¼ åˆ° algolia äº†

### [](#22-ä¸Šä¼ ç´¢å¼•)[2.2 ä¸Šä¼ ç´¢å¼•](#contents:22-ä¸Šä¼ ç´¢å¼•)

ä¸Šä¼ åˆ° algolia ç›¸å¯¹æ¥è¯´å°±æ¯”è¾ƒç®€å•äº†ã€‚æˆ‘ç”¨çš„æ˜¯ _atomic-algolia_ã€‚é¦–å…ˆ[å®‰è£… npm](https://www.npmjs.com/get-npm)ï¼Œç„¶ååœ¨ç«™ç‚¹æ ¹ç›®å½•ä¸‹é¢è¿è¡Œï¼š

npm init æ˜¯ç”¨æ¥ç”Ÿæˆé»˜è®¤çš„ package.jsonï¼ŒåŸºæœ¬ä¸Šä¸€è·¯å›è½¦å°±è¡Œäº†ã€‚è¿è¡Œè¿è¡Œå®Œè¿™ä¸¤ä¸ªå‘½ä»¤ä¹‹åï¼Œæ‰“å¼€ package.json æ–‡ä»¶ï¼Œåœ¨ "scripts" è¿™éƒ¨åˆ†å¢åŠ ä¸€å¥ "algolia": "atomic-algolia"ã€‚ä¿®æ”¹å®Œæ¯•ä¹‹ååº”è¯¥é•¿è¿™æ ·ï¼š

```
\[outputs\]
  home = \["HTML", "RSS", "Algolia"\]
```

å®Œæˆä¹‹åï¼Œè¿˜éœ€è¦æ–°å»ºä¸€ä¸ª. env çš„æ–‡ä»¶ï¼Œå‘Šè¯‰ atomic-algolia ä¸€äº›ä¿¡æ¯ï¼š

å¡«å†™å¹¶ä¿å­˜ä¹‹åï¼Œå¯ä»¥å°è¯•æŠŠç´¢å¼•æäº¤ç»™ Algolia äº†ï¼š

å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œé‚£ä¹ˆåº”è¯¥çœ‹åˆ°çš„æ˜¯ç±»ä¼¼äºä¸‹é¢è¿™å¼ å›¾ç‰‡ï¼ˆæˆ‘æ‡’å¾—æˆªå›¾ï¼Œç”¨äº†ä¸Šé¢é‚£ä¸ª blog çš„æˆªå›¾ï¼‰ï¼š

![](https://www.bennet.org/blog/site-search-jamstack-hugo-algolia/images/5.png)

### [](#23-ä¿®æ”¹algoliaçš„è®¾ç½®)[2.3 ä¿®æ”¹ Algolia çš„è®¾ç½®](#contents:23-ä¿®æ”¹algoliaçš„è®¾ç½®)

ä¸Šä¼ å®Œæ¯•ç´¢å¼•ä¹‹åï¼Œè¿˜éœ€è¦åœ¨ Algolia é‡Œé¢è®¾ç½®ä¸€ä¸‹ã€‚ç‚¹å‡» Indicesï¼Œç„¶åæ‰¾åˆ° Configuration è¿™ä¸ª tabã€‚ä¸»è¦ä¿®æ”¹ä¸‹é¢å‡ ä¸ªé€‰é¡¹ï¼š

1.  Searchable attributes
    
    è¿™ä¸ªé€‰é¡¹ç”¨æ¥å‘Šè¯‰ Algoliaï¼Œåœ¨å“ªäº›ç´¢å¼•é‡Œé¢è¿›è¡Œæœç´¢ã€‚æ¯”å¦‚ï¼Œæˆ‘ä¸éœ€è¦ Algolia åœ¨æ—¥æœŸå’Œ URL é‡Œé¢è¿›è¡Œæœç´¢ï¼ˆä¸€èˆ¬äººéƒ½ä¸éœ€è¦å§ï¼‰ï¼Œæ‰€ä»¥æˆ‘çš„é€‰é¡¹æ˜¯ titleï¼Œtagsï¼Œcontent å’Œ categoriesã€‚
    
2.  Ranking and Sorting
    
    è¿™ä¸ªä¸»è¦æ˜¯æ’åºï¼Œé™¤äº† Algolia è‡ªå·±é»˜è®¤çš„ä¹‹å¤–ï¼Œæˆ‘è¿˜å¢åŠ äº† dateã€‚ä¼˜å…ˆæ˜¾ç¤ºæœ€è¿‘å‘è¡¨çš„åšå®¢ã€‚
    
3.  Duplication and Grouping
    
    æˆ‘ä»¬ä¹‹å‰æŠŠä¸€æ¡åšå®¢æ‹†åˆ†æˆäº†å¥½å¤šæ¡ç´¢å¼•ï¼Œå› æ­¤é»˜è®¤æƒ…å†µä¸‹ Algolia å¦‚æœåœ¨åŒä¸€ç¯‡åšå®¢çš„ä¸åŒç´¢å¼•æ‰¾åˆ°äº†åŒä¸€ä¸ªå…³é”®è¯ï¼Œä¼šæŠŠè¿™äº›ç´¢å¼•éƒ½æ˜¾ç¤ºå‡ºæ¥ã€‚è¿™å°±æœ‰äº›æ²¡å¿…è¦äº†ã€‚æ‰€ä»¥å¯ä»¥åœ¨è¿™é‡Œè¿›è¡Œè®¾ç½®ï¼ŒæŠŠ Distinct è®¾ç½®ä¸º trueï¼Œç„¶å Attribute for Distinct è®¾ç½®ä¸º urlï¼Œæˆ–è€… titleã€‚
    
4.  Highlighting
    
    è¿™é‡Œæœ€é‡è¦çš„æ˜¯è®¾ç½®æœç´¢ç»“æœä¸­é«˜äº®çš„ tagã€‚Algolia é»˜è®¤ç”¨äº†`<em>`å’Œ`</em>`æ¥è¿›è¡Œé«˜äº®ï¼Œä½†æ˜¯ LoveItï¼ˆæˆ–è€… hugoï¼Ÿï¼‰ç”¨äº†è¿™ä¸ªæ ‡ç­¾æ¥æ ‡è®°æ–œä½“ã€‚å› æ­¤éœ€è¦ä¿®æ”¹ä¸€ä¸‹ã€‚äºæ˜¯æˆ‘æŠŠæ ‡ç­¾ä¿®æ”¹æˆäº†`<m>`å’Œ`</m>`ã€‚
    
5.  è®°å¾—ç‚¹ Review and Save Settings æ¥ä¿å­˜ä¿®æ”¹
    

### [](#24-å’Œnetlifyç»“åˆ)[2.4 å’Œ Netlify ç»“åˆ](#contents:24-å’Œnetlifyç»“åˆ)

æ¯æ¬¡æ›´æ–° blog ä¹‹åæ‰‹åŠ¨ç”Ÿæˆå’Œä¸Šä¼ ç´¢å¼•è‚¯å®šä¸æ˜¯ä¸€ä¸ªæ–¹ä¾¿çš„è§£å†³æ–¹æ¡ˆã€‚å¥½åœ¨æˆ‘çš„åšå®¢é‡‡ç”¨äº† Netlify æ¥éƒ¨ç½²ï¼Œä½¿ç”¨ Netlify çš„è¯ä½¿å¾—éƒ¨ç½²æ›´æ–¹ä¾¿ã€‚æ€ä¹ˆæ³¨å†Œ Netlifyï¼Œå¦‚ä½•æŠŠ Netlify å’Œ GitHub æ•´åˆä¹Ÿä¸æ˜¯è¿™ç¯‡ blog è¦ cover çš„å†…å®¹ã€‚ä¸‹é¢çš„å†…å®¹å‡è®¾ä½ å·²ç»å¯ä»¥æˆåŠŸåœ¨ Netlify ä¸Šé¢éƒ¨ç½²åšå®¢ç«™ç‚¹äº†ã€‚

é¦–å…ˆï¼Œåœ¨ settings çš„ Build & deploy é‡Œé¢æ‰¾åˆ° Environmentï¼Œç„¶åç‚¹å‡» Edit variablesã€‚ç‚¹å‡» New variablesï¼ŒæŠŠåˆšæ‰. env é‡Œé¢çš„ 4 ä¸ªå˜é‡åˆ†åˆ«å¡«è¿›å»å°±è¡Œäº†ã€‚ç±»ä¼¼è¿™æ ·ï¼š

![](https://www.dreamsafari.info/uploads/2020/04/netlify.jpg)

ä¹‹åï¼Œä¿®æ”¹æ ¹ç›®å½•ä¸‹ netlify.tomlï¼ŒæŠŠ {?\[}build\] ä¸‹é¢çš„ command è¡Œä¿®æ”¹ä¸ºï¼š

```
{{- $index := slice -}}
{{- range $page := $.Site.RegularPages -}}
  {{- $cleaned := slice -}}
  {{- $cleaned = $page.Plain}}
  {{- $cleaned = replace $cleaned "\\r" ""}}
  {{- $cleaned = replace $cleaned "\\n" ""}}
  {{- $cleaned = replace $cleaned "\\u0026rsquo;" "'"}}
  {{- $cleaned = replace $cleaned "\\u0026amp;" "&"}}
  {{- $cleaned = replace $cleaned "\\u0026#34;" "\\""}}
  {{- $cleaned = replace $cleaned "\\u0026#39;" "'"}}
  {{- $cleaned = replace $cleaned "\\u0026ndash;" "-"}}
  {{- $cleaned = replace $cleaned "\\u0026gt;" ">"}}
  {{- $cleaned = replace $cleaned "\\u0026quot;" "\\""}}
  {{- $cleaned = replace $cleaned "\\u0026ldquo;" "â€œ"}}
  {{- $cleaned = replace $cleaned "\\u0026rdquo;" "â€"}}
  {{- $chunked := slice -}}
  {{- $chunked = $chunked | append (substr $cleaned 0 500) -}}
  {{- if gt (countwords $cleaned) 500 }}
    {{- $chunked = $chunked | append (substr $cleaned 500 500) -}}
  {{- end -}}
  {{- if gt (countwords $cleaned) 1000 }}
    {{- $chunked = $chunked | append (substr $cleaned 1000 500) -}}
  {{- end -}}
//
// ä¸­é—´çœç•¥ï¼Œå¤§å®¶æ ¹æ®è‡ªå·±blogçš„é•¿çŸ­æ¥å†³å®šå†™å¤šå°‘è¡Œå§ã€‚å»ºè®®ç›´æ¥å†™ä¸€ä¸ªè„šæœ¬æˆ–è€…ç”¨Excelç”Ÿæˆâ€¦â€¦
//
  {{- range $i, $c := $chunked -}}
    {{- $index = $index | append (dict "objectID" (print $page.File.UniqueID "\_" $i) "content" $c "order" $i "title" $page.Title "date" $page.Date "url" $page.Permalink "tags" $page.Params.tags "categories" $page.Params.Categories) -}}
  {{- end -}}
{{- end -}}
{{- $index | jsonify -}}
```

è¿™æ ·ï¼Œä¸‹æ¬¡æ›´æ–°å®Œåšå®¢ä¹‹åï¼Œnetlify å°±ä¼šè‡ªåŠ¨ç”Ÿæˆç´¢å¼•ï¼Œå¹¶ä¸”æäº¤ç»™ Algolia äº†ã€‚

### [](#25-ä¸ºä¸»é¢˜å¢åŠ æœç´¢é¡µ)[2.5 ä¸ºä¸»é¢˜å¢åŠ æœç´¢é¡µ](#contents:25-ä¸ºä¸»é¢˜å¢åŠ æœç´¢é¡µ)

è¿™éƒ¨åˆ†å§ï¼Œä¸»è¦éš¾ç‚¹åœ¨ä¿®æ”¹ cssâ€¦â€¦ ç†Ÿæ‚‰æˆ‘çš„éƒ½çŸ¥é“æˆ‘æ˜¯ä¸ªå­¦è´¢åŠ¡å’Œé‡‘èåšå’¨è¯¢çš„ï¼Œ~ä½“å¥è²Œç«¯æ€æƒ³å¼€æ”¾~ï¼ŒæŠ€æœ¯å®…åªæ˜¯ä¸šä½™çˆ±å¥½ã€‚å¥½åœ¨åšå’¨è¯¢çš„ï¼Œå¯¹äº Google çš„ä½¿ç”¨è¿˜ç®—ç•¥æœ‰ä¸€äº›å¿ƒå¾—ã€‚æ‘¸çˆ¬æ»šæ‰“è¯¯æ‰“è¯¯æ’ä¹‹åï¼Œå±…ç„¶ä¹Ÿç»™æˆ‘æ”¹å‡ºæ¥äº†â€¦â€¦

ä¹‹å‰è§£å†³äº†æˆ‘ä»¬åˆ†å‰²è®°å½•é—®é¢˜çš„å“¥ä»¬ä¹Ÿ[ç»™äº†ä¸€ä¸ªä»£ç ](https://www.bennet.org/blog/site-search-jamstack-hugo-algolia/)ï¼Œåšå‡ºäº†ä¸€ä¸ª**ç”µè„‘ä¸Š**æŒºå¥½ç”¨çš„å³æ—¶æœç´¢æ¡†ã€‚å¯æƒœè¿™ä¸ªæ¡†åœ¨æ‰‹æœºä¸Šä¸å¤ªå¥½ç”¨ï¼Œæ‰€ä»¥æˆ‘å†³å®šè¿˜æ˜¯æ–°å»ºä¸€ä¸ªæœç´¢é¡µï¼Œä¸“é—¨ç”¨æ¥æœç´¢å§ã€‚

é¦–å…ˆï¼Œåœ¨ / content ä¸‹é¢æ–°å»ºä¸€ä¸ª search.md æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

æ—¥æœŸè®¾ç½®ä¸º 1970 å¹´çš„åŸå› æ˜¯æœç´¢é¡µé¢åœ¨è¾“å…¥å…³é”®è¯å‰ï¼Œä¼šæ˜¾ç¤ºæœ€è¿‘æ›´æ–°çš„ 10 ç¯‡æ–‡ç« ã€‚è¿™æ ·è®¾ç½®å¯ä»¥é¿å…æœç´¢çš„æ—¶å€™å…ˆæ˜¾ç¤ºäº†è¿™ç¯‡æ–‡ç« ã€‚

ç„¶åï¼Œåœ¨ / layouts ä¸‹æ–°å»º static æ–‡ä»¶å¤¹ï¼Œæ”¾å…¥ search.htmlã€‚è¿™ä¸ªæ–‡ä»¶æ¯”è¾ƒå¤§ï¼Œå°±ä¸è´´åœ¨è¿™é‡Œäº†[ç‚¹è¿™é‡Œä¸‹è½½](https://github.com/dreamsafari/LoveIt/blob/master/layouts/static/search.html)ã€‚

æ¥ä¸‹æ¥æ˜¯ä¿®æ”¹ cssï¼Œå¦åˆ™çš„è¯è¿™ä¸ªæœç´¢ä¸‘ä¸‘çš„ã€‚æˆ‘ç›´æ¥ç”¨äº† Algolia ç»™çš„ç¤ºä¾‹ä¸»é¢˜è¿›è¡Œä¿®æ”¹ã€‚æ–‡ä»¶å¤ªå¤§æˆ‘ä¹Ÿä¸è´´äº†ï¼Œ[ç‚¹è¿™é‡Œä¸‹è½½](https://github.com/dreamsafari/LoveIt/blob/master/assets/css/_page/_search.scss)ä¹‹åæ”¾åœ¨ / assets/css/\_page ä¸­ã€‚è®°å¾—ä¿®æ”¹\_index.scss æ–‡ä»¶æ¥å¼•å…¥\_search.scss

æœ€åï¼Œéœ€è¦åœ¨å¯¼èˆªæ ä¸­å¼•å…¥æœç´¢é¡µã€‚è¿™ä¸ªè¶…çº§ç®€å•ï¼Œç›´æ¥åœ¨ config.toml ä¸­å¢åŠ ä¸€é¡¹ \[\[menu.main\]\]ï¼š

```
npm init
npm install atomic-algolia --save-dev
```

å®Œæˆä¹‹åï¼Œæœç´¢éƒ¨åˆ†å°±æå®šå•¦ï¼

[](#3-pwa)[3\. PWA](#contents:3-pwa)
------------------------------------

PWA çº¯ç²¹æ˜¯ï¼Œå¥½ç©â€¦â€¦ æ˜¯æˆ‘åœ¨çœ‹ [hugo-theme-meme](https://github.com/reuixiy/hugo-theme-meme) çš„æ—¶å€™å‘ç°çš„ã€‚æ‰€ä»¥ï¼Œå…·ä½“è¿‡ç¨‹[å‚è€ƒè¿™ç¯‡æ–‡ç« ](https://io-oi.me/tech/pwa-via-workbox/)å°±è¡Œäº†ã€‚

è¯´å‡ ä¸ªéœ€è¦æ³¨æ„å’Œä¿®æ”¹çš„åœ°æ–¹ï¼š

1.  å› ä¸ºä¹‹å‰ç”Ÿæˆäº† algolia.jsonï¼Œå¦‚æœå†…å®¹å¤šçš„è¯ï¼Œè¿™ä¸ªæ–‡ä»¶è¿˜æŒºå¤§çš„ã€‚è™½ç„¶æˆ‘ä¸çŸ¥é“è¿™ä¸ªæ–‡ä»¶ä¼šä¸ä¼šè¢«ç¼“å­˜ï¼Œä½†æ˜¯è€ƒè™‘åˆ°æˆ‘å…¶å®å¹¶æ²¡æœ‰å…¶ä»–ç”¨åˆ° json çš„åœ°æ–¹ï¼Œæ‰€ä»¥æˆ‘è¿˜æ˜¯å†³å®šåœ¨ gulpfile.js é‡Œé¢çš„ globPatterns éƒ¨åˆ†åˆ æ‰äº† jsonã€‚
    
2.  æˆ‘å¢åŠ äº† [Google çš„ PWA Compact](https://github.com/GoogleChromeLabs/pwacompat)ï¼Œå¯ä»¥è‡ªåŠ¨æ ¹æ® manifest.webmanifest æ¥ç”Ÿæˆå„ç§ä¸œè¥¿æ”¯æŒå…¶ä»–æµè§ˆå™¨ã€‚è¿™ä¹ˆåšéœ€è¦ä¿®æ”¹ / layouts/partials/head/link.htmlï¼Œå¢åŠ ä¸‹é¢è¿™ä¸€è¡Œï¼š
    
    è®°å¾—æ£€æŸ¥ä¸€ä¸‹ï¼Œlink.html é‡Œé¢é‚£ä¸ª manifest æ–‡ä»¶çš„æ–‡ä»¶åæ˜¯å¦å’Œ / static é‡Œé¢çš„æ–‡ä»¶åä¸€è‡´ã€‚å…·ä½“å« manifest.json è¿˜æ˜¯ site.webmanifest è¿˜æ˜¯ manifest.webmanifest æ— æ‰€è°“ï¼Œåªè¦æ–‡ä»¶åä¸€è‡´å°±è¡Œã€‚
    
3.  æ³¨å†Œ Service Worker å’Œæé†’çš„ä»£ç æˆ‘æ”¾åœ¨äº† / layouts/partials/footer.html é‡Œé¢ï¼Œç…§æŠ„å°±è¡Œã€‚
    
4.  CSS è„šæœ¬æˆ‘åŸå°ä¸åŠ¨åœ°æ”¾åœ¨äº† / assets/css/\_core/\_pwa.scss é‡Œé¢ï¼Œç„¶åè®°å¾—ä¿®æ”¹ / assets/css/style.template.scss æ¥å¼•å…¥å¢åŠ çš„ scss æ–‡ä»¶ã€‚
    

è€è§„çŸ©ï¼Œæµ‹è¯•é€šè¿‡ä¹‹åå¯ä»¥äº¤ç»™ Netlifyã€‚è¿˜æ˜¯ä¿®æ”¹ netlify.toml æ–‡ä»¶ï¼Œå¢åŠ å‘½ä»¤ã€‚å’Œ Algolia æœç´¢çš„ç›¸å…³å‘½ä»¤æ•´åˆä¹‹åï¼Œè¿™ä¸ªæ–‡ä»¶ç°åœ¨é•¿è¿™æ ·ï¼š

```
"scripts": {
  "test": "echo \\"Error: no test specified\\" && exit 1",
  "algolia": "atomic-algolia"
},
```

æ›´æ–°æˆåŠŸä¹‹åï¼Œå¯ä»¥ç”¨ [Lighthouse](https://developers.google.com/web/tools/lighthouse) æ¥æ£€æŸ¥ä¸€ä¸‹ã€‚å¦‚æœæç¤ºæœ‰ä»»ä½•é”™è¯¯ï¼Œä¿®æ­£å³å¯ã€‚

ç”±äºä¼—æ‰€å‘¨çŸ¥çš„åŸå› ï¼Œå›½å†…ç°åœ¨è®¿é—®ä¸äº† disqusï¼Œå’Œä¸€äº›å…¶ä»–çš„ç½‘ç«™äº†ã€‚æ‰€ä»¥é™¤äº†ç§‘å­¦ä¸Šç½‘ä¹‹å¤–ï¼Œè¿˜éœ€è¦ç§‘å­¦è¯„è®ºâ€¦â€¦ é‡‡ç”¨çš„æ–¹æ¡ˆæ˜¯ [SukkaW/DisqusJS](https://github.com/SukkaW/DisqusJS)ã€‚è¿™æ˜¯ä¸€ä¸ªè¶…è½»é‡çº§çš„ä»£ç†ï¼Œå¯ä»¥è‡ªåŠ¨æ£€æµ‹è®¿å®¢çš„ Disqus å¯ç”¨æ€§ï¼Œè‡ªåŠ¨é€‰æ‹©åŠ è½½åŸç”Ÿ Disqusï¼ˆè¯„è®ºå®Œæ•´æ¨¡å¼ï¼‰å’Œ DisqusJS æä¾›çš„è¯„è®ºåŸºç¡€æ¨¡å¼ã€‚

Disqus ä»£ç†çš„å¦å¤–ä¸€ä¸ªé€‰é¡¹æ˜¯ [szhielelp/disqus-proxy](https://github.com/szhielelp/disqus-proxy)ã€‚è¿™ä¸ªæ–¹æ¡ˆçš„ä¼˜ç‚¹æ˜¯å¯ä»¥åŒ¿åè¯„è®ºï¼Œå¯æ˜¯ deal breaker æ˜¯ä»–ç”¨äº† bootstrap CSSï¼Œä¼šå’Œä¸»é¢˜çš„ CSS å†²çªã€‚å› æ­¤ä½œä¸ºä¸€ä¸ªæ‡’äººï¼Œæˆ‘æ–­ç„¶å†³å®šæ”¾å¼ƒã€‚

DisqusJS éƒ¨ç½²èµ·æ¥è¶…çº§ç®€å•ï¼Œæˆ‘åç«¯ç”¨ [ZEIT Now](https://zeit.co/)ï¼Œåªéœ€è¦ä¸€ä¸ª now.json æ–‡ä»¶å°±è¡Œäº†ã€‚ä¸éœ€è¦ä¸‹è½½ now çš„æ•™ç¨‹[å‚ç…§è¿™é‡Œ](https://github.com/SukkaW/disqusjs-proxy-example)ã€‚çœ‹ä¸Šå»åªéœ€è¦éƒ¨ç½²ä¸€æ¬¡ï¼Œä¸€åŠ³æ°¸é€¸ã€‚

å‰ç«¯çš„è¯ï¼Œä¹Ÿä¸å¤æ‚ï¼Œåªéœ€è¦åœ¨ config.toml é‡Œé¢å¢åŠ å‡ ä¸ªå˜é‡ï¼Œç„¶ååŠ¨ä¸€åŠ¨ / layouts/partials/comment.html è¿™ä¸ªæ–‡ä»¶å°±è¡Œäº†ã€‚

config.toml å¢åŠ çš„å˜é‡ï¼š

```
ALGOLIA\_APP\_ID={{ YOUR\_APP\_ID }}
ALGOLIA\_ADMIN\_KEY={{ YOUR\_ADMIN\_KEY }}
ALGOLIA\_INDEX\_NAME={{ YOUR\_INDEX\_NAME }}
ALGOLIA\_INDEX\_FILE=public/algolia.json
```

å˜é‡è¯´æ˜ï¼š

/layouts/partials/comment.html çš„ä¿®æ”¹ï¼šåœ¨`<div></div>`ä¸‹é¢æ’å…¥è¿™æ®µä»£ç ï¼š

è¿™é‡Œæ²¡æœ‰å¼•å…¥ [DisqusJS é»˜è®¤ CSS](https://github.com/SukkaW/DisqusJS/blob/master/src/disqusjs.css) çš„åŸå› æ˜¯ï¼ŒLoveIt ä¼šæ ¹æ®ç³»ç»Ÿè®¾ç½®å¯ç”¨å¤œæ™šæ¨¡å¼ï¼Œè€Œå¤œæ™šæ¨¡å¼ä¸‹ DisqusJS çš„é»˜è®¤é¢œè‰²å°±æ¯”è¾ƒåˆºçœ¼äº†ã€‚è§£å†³æ–¹å¼æ˜¯[ä¸‹è½½è¿™ä¸ªæ–‡ä»¶](https://github.com/dreamsafari/LoveIt/blob/master/assets/css/_partial/_single/_disqusjs.scss)ï¼Œä¿å­˜åˆ° / assets/css/\_partial/\_single/ï¼Œæœ€ååœ¨åŒç›®å½•ä¸‹çš„\_comment.scss æœ€åå¢åŠ ä¸€å¥ä»£ç `@import "_disqusjs.scss";`æ¥å¼•å…¥ä¿®æ”¹ä¹‹åçš„ scss æ–‡ä»¶ã€‚

éœ€è¦æä¸€ä¸‹çš„æ˜¯ï¼Œé»˜è®¤åœ¨ development ç¯å¢ƒä¸‹ LoveIt æ˜¯ä¸ä¼šæ¸²æŸ“ Disqus çš„ã€‚æ‰€ä»¥è¦ä¹ˆç›´æ¥åœ¨ production é‡Œé¢æµ‹è¯•ï¼Œè¦ä¹ˆæš‚æ—¶æŠŠ`{{- if $scratch.Get "production" | and (ne .Site.Params.comment.enable false) | and (ne .Params.comment false) -}}`é‡Œé¢çš„ production æ”¹æˆ developmentã€‚éƒ¨ç½²ä¹‹å‰è®°å¾—æ”¹å›æ¥å°±å¥½ã€‚

[](#5-æ‡’äººæ–¹æ¡ˆ)[5\. æ‡’äººæ–¹æ¡ˆ](#contents:5-æ‡’äººæ–¹æ¡ˆ)
---------------------------------------

è¯´äº†é‚£ä¹ˆå¤šï¼Œå¦‚æœä¸Šé¢è¿™äº›åŠŸèƒ½éƒ½æƒ³è¦çš„è¯ï¼Œæˆ‘åœ¨ GitHub ä¸Šé¢ [fork å¹¶ä¿®æ”¹äº† LoveIt çš„æºç ](https://github.com/dreamsafari/loveit)ï¼Œç›´æ¥ç”¨`git submodule add --depth 1 https://github.com/dreamsafari/loveit.git themes/LoveIt`ï¼Œç„¶åä¿®æ”¹ config.toml å³å¯ã€‚

[](#6-åè¯)[6\. åè¯](#contents:6-åè¯)
---------------------------------

é€‰æ‹© LoveIt è¿™ä¸ªä¸»é¢˜ï¼Œå¾ˆå¤§ä¸€éƒ¨åˆ†çš„åŸå› æ˜¯å› ä¸º[ä¸°å¯Œçš„ Shortcodes æ”¯æŒ](https://hugoloveit.com/zh-cn/theme-documentation-shortcodes/)ã€‚è€ƒè™‘åˆ°æˆ‘ç›®å‰å¿ƒæ°´ [hugo-theme-meme](https://github.com/reuixiy/hugo-theme-meme) è¿™ä¸ªä¸»é¢˜ï¼Œæ‰€ä»¥ä¼°è®¡æ¥ä¸‹æ¥ä¸€æ®µæ—¶é—´é‡Œé¢ï¼Œå¦‚æœæœ‰ç©ºçš„è¯ï¼Œä¼šå°è¯•ä¸€ä¸‹èƒ½ä¸èƒ½æŠŠ Shortcodes å’Œè¿™äº›åŠŸèƒ½ç§»æ¤åˆ° meme ä¸Šé¢å§â€¦â€¦ å…³äºè¿™äº›åŠŸèƒ½åœ¨ LoveIt ä¸Šé¢çš„å®ç°ï¼Œå¦‚æœæœ‰é—®é¢˜çš„è¯å¤§å®¶åœ¨ä¸‹é¢ç•™ä¸ªè¨€å§ã€‚

updatedupdated2020-07-102020-07-10